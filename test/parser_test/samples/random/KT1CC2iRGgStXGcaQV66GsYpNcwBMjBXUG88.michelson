parameter (pair %addToken (string %address) (nat %tokenType)); storage (big_map address (map string (pair (string %address) (nat %tokenType)))); code { UNPAIR ; PUSH bool False ; DUP 3 ; SENDER ; MEM ; COMPARE ; EQ ; IF { SWAP ; PUSH (option (map string (pair string nat))) (Some {}) ; SENDER ; UPDATE ; DUP ; SENDER ; DUP ; DUG 2 ; GET ; IF_NONE { PUSH int 19 ; FAILWITH } {} ; DIG 3 ; DUP ; CDR ; SWAP ; DUP ; DUG 5 ; CAR ; PAIR ; SOME ; DIG 4 ; CAR ; UPDATE ; SOME ; SWAP ; UPDATE } { SWAP ; DUP ; SENDER ; DUP ; DUG 2 ; GET ; IF_NONE { PUSH int 21 ; FAILWITH } {} ; DIG 3 ; DUP ; CDR ; SWAP ; DUP ; DUG 5 ; CAR ; PAIR ; SOME ; DIG 4 ; CAR ; UPDATE ; SOME ; SWAP ; UPDATE } ; NIL operation ; PAIR }