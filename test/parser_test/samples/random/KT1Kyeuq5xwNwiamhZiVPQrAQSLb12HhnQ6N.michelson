parameter (unit %go_to_the_kitchen); storage (pair (timestamp %end_party) (pair (big_map %metadata string bytes) (big_map %participants address unit))); view "attended" address bool { UNPAIR ; SWAP ; GET 4 ; SWAP ; MEM }; code { CDR ; DUP ; CAR ; NOW ; COMPARE ; LT ; IF {} { PUSH string "Someone called the police and the party is finished :(" ; FAILWITH } ; DUP ; GET 4 ; SENDER ; MEM ; IF { PUSH string "You already joined the party! Are you drunk?" ; FAILWITH } {} ; DUP ; GET 4 ; PUSH (option unit) (Some Unit) ; SENDER ; UPDATE ; UPDATE 4 ; NIL operation ; PAIR }