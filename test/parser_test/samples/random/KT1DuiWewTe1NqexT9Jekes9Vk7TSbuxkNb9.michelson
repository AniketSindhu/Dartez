parameter (pair %setData (string %objktids) (string %username)); storage (map string (pair (address %addr) (string %objktids))); code { UNPAIR ; SWAP ; DUP ; DUG 2 ; ITER { SWAP ; DUP ; DUG 2 ; CDR ; SWAP ; DUP ; DUG 2 ; CAR ; COMPARE ; EQ ; IF { GET 3 ; SENDER ; COMPARE ; NEQ ; IF { PUSH string "username taken" ; FAILWITH } {} } { DROP } } ; SWAP ; DUP ; DUG 2 ; SWAP ; DUP ; DUG 2 ; CDR ; MEM ; IF { SWAP ; DUP ; DUP 3 ; CDR ; DUP ; DUG 2 ; GET ; IF_NONE { PUSH int 13 ; FAILWITH } {} ; DIG 3 ; CAR ; UPDATE 2 ; SOME ; SWAP ; UPDATE } { DUP ; DUG 2 ; CAR ; SENDER ; PAIR ; SOME ; DIG 2 ; CDR ; UPDATE } ; NIL operation ; PAIR }