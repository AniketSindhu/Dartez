parameter (or (key_hash %register) (key_hash %validate)); storage (big_map key_hash bool); code { PUSH string "412" ; LAMBDA (pair string (pair key_hash (big_map key_hash bool))) (pair (list operation) (big_map key_hash bool)) { UNPAIR ; SWAP ; UNPAIR ; DIG 2 ; PUSH mutez 0 ; AMOUNT ; COMPARE ; EQ ; IF { DROP } { FAILWITH } ; SWAP ; PUSH bool True ; DUP 3 ; SWAP ; SOME ; SWAP ; UPDATE ; NIL operation ; DIG 2 ; SOME ; SET_DELEGATE ; CONS ; PAIR } ; DUP 2 ; APPLY ; DIG 2 ; UNPAIR ; IF_LEFT { DIG 3 ; DROP ; PAIR ; EXEC } { DIG 3 ; PUSH mutez 0 ; AMOUNT ; COMPARE ; EQ ; IF { DROP } { FAILWITH } ; DUP 2 ; DUP 2 ; GET ; IF_NONE { PAIR ; EXEC } { SWAP ; DIG 3 ; DROP 3 ; NIL operation ; PAIR } } }