parameter (pair %setData (string %objktids) (string %username)); storage (map address (pair (string %objktids) (string %username))); code { UNPAIR ; SWAP ; DUP ; DUG 2 ; ITER { SWAP ; DUP ; DUG 2 ; CDR ; SWAP ; DUP ; DUG 2 ; GET 4 ; COMPARE ; EQ ; IF { CAR ; SENDER ; COMPARE ; NEQ ; IF { PUSH string "username taken" ; FAILWITH } {} } { DROP } } ; SWAP ; DUP ; DUG 2 ; SENDER ; MEM ; IF {} { SWAP ; PUSH (option (pair string string)) (Some (Pair "" "")) ; SENDER ; UPDATE ; SWAP } ; SWAP ; DUP ; SENDER ; DUP ; DUG 2 ; GET ; IF_NONE { PUSH int 10 ; FAILWITH } {} ; DUP 4 ; CDR ; UPDATE 2 ; SOME ; SWAP ; UPDATE ; DUP ; SENDER ; DUP ; DUG 2 ; GET ; IF_NONE { PUSH int 11 ; FAILWITH } {} ; DIG 3 ; CAR ; UPDATE 1 ; SOME ; SWAP ; UPDATE ; NIL operation ; PAIR }