parameter (nat %increment); storage (pair (map %callers address bool) (nat %number)); code { UNPAIR ; DUP 2 ; CAR ; SENDER ; MEM ; IF { PUSH string "Sender has already incremented. Each Address can only increment once" ; FAILWITH } {} ; SWAP ; DUP ; CAR ; PUSH (option bool) (Some True) ; SENDER ; UPDATE ; UPDATE 1 ; SWAP ; PUSH mutez 1000000 ; DUP 2 ; MUL ; AMOUNT ; COMPARE ; GE ; IF {} { PUSH string "Insufficient tez sent" ; FAILWITH } ; PUSH mutez 1000000 ; DUP ; DIG 2 ; MUL ; COMPARE ; EQ ; IF {} { PUSH string "Incorrect amount of tez sent" ; FAILWITH } ; DUP ; CDR ; PUSH nat 1 ; ADD ; UPDATE 2 ; NIL operation ; PAIR }