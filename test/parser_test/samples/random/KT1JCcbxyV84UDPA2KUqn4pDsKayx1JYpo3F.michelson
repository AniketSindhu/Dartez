parameter (pair (list (pair (pair string bytes) string)) bool); storage (pair (pair (set (pair (pair string bytes) string)) string) (pair (big_map string bytes) address)); code { UNPAIR ; SWAP ; DUP ; DUG 2 ; CDR ; CDR ; SENDER ; COMPARE ; NEQ ; IF { PUSH string "Unauthorized." ; FAILWITH } {} ; PUSH mutez 0 ; AMOUNT ; COMPARE ; GT ; IF { PUSH string "Tez not accepted." ; FAILWITH } {} ; UNPAIR ; DUP 3 ; CDR ; CDR ; DUP 4 ; CDR ; CAR ; PAIR ; DUP 4 ; CAR ; CDR ; DIG 4 ; CAR ; CAR ; DIG 3 ; ITER { SWAP ; DUP 5 ; DIG 2 ; UPDATE } ; DIG 3 ; DROP ; PAIR ; PAIR ; NIL operation ; PAIR }